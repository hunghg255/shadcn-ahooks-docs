{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useSSE",
  "title": "useSSE",
  "description": "useSSE external hook",
  "dependencies": [
    "@microsoft/fetch-event-source"
  ],
  "files": [
    {
      "path": "packages/external-hooks/src/useSSE/index.ts",
      "content": "import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { fetchEventSource, type EventSourceMessage } from \"@microsoft/fetch-event-source\";\n\nexport interface UseSSEOptions {\n  url: string;\n  headers?: Record<string, string>;\n  method?: string;\n  body?: string | FormData;\n  onMessage?: (message: EventSourceMessage) => void;\n  onOpen?: (response: Response) => void;\n  onError?: (error: unknown) => void;\n  fetch?: typeof window.fetch;\n  openWhenHidden?: boolean;\n}\n\ntype TReadyState = 'CONNECTING' | 'OPEN' | 'CLOSED'; // 0: connecting, 1: open, 2: closed\n\nexport interface UseSSEResult {\n  readyState: TReadyState;\n  close: () => void;\n  reconnect: () => void;\n}\n\nfunction useSSE(options: UseSSEOptions): UseSSEResult {\n  const { url, headers, method, body, onMessage, onOpen, onError, fetch: customFetch, openWhenHidden } = options;\n  const [readyState, setReadyState] = useState<TReadyState>('CONNECTING');\n  const controllerRef = useRef<AbortController | null>(null);\n\n  const connect = useCallback(() => {\n    if (controllerRef.current) {\n      controllerRef.current.abort();\n    }\n\n    const controller = new AbortController();\n    controllerRef.current = controller;\n\n    fetchEventSource(url, {\n      method: method || 'GET',\n      headers: headers,\n      body: body,\n      signal: controller.signal,\n      fetch: customFetch,\n      openWhenHidden: openWhenHidden ?? true,\n\n      async onopen(response) {\n        setReadyState('OPEN');\n        onOpen?.(response);\n      },\n\n      onmessage(message) {\n        onMessage?.(message);\n      },\n\n      onerror(err) {\n        setReadyState('CLOSED');\n        onError?.(err);\n      },\n    });\n  }, [url, headers, method, body, openWhenHidden]);\n\n  const close = useCallback(() => {\n    if (controllerRef.current) {\n      controllerRef.current.abort();\n      setReadyState('CLOSED');\n    }\n  }, []);\n\n  useEffect(() => {\n    connect();\n    return () => {\n      close();\n    };\n  }, []);\n\n  return {\n    readyState,\n    close,\n    reconnect: connect,\n  };\n}\n\nexport default useSSE;\n",
      "type": "registry:file",
      "target": "src/hooks/external-hooks/useSSE/index.ts"
    }
  ],
  "type": "registry:hook"
}
