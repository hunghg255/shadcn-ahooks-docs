{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useReactive",
  "title": "useReactive",
  "description": "useReactive hook",
  "dependencies": [
    "es-toolkit"
  ],
  "registryDependencies": [
    "useCreation.json",
    "useUpdate.json"
  ],
  "files": [
    {
      "path": "packages/hooks/src/useReactive/index.ts",
      "content": "import { useRef } from 'react';\nimport { isPlainObject } from 'es-toolkit/compat';\nimport useCreation from '../useCreation';\nimport useUpdate from '../useUpdate';\n\n// k:v 原对象:代理过的对象\nconst proxyMap = new WeakMap();\n// k:v 代理过的对象:原对象\nconst rawMap = new WeakMap();\n\nfunction observer<T extends Record<string, any>>(initialVal: T, cb: () => void): T {\n  const existingProxy = proxyMap.get(initialVal);\n\n  // 添加缓存 防止重新构建proxy\n  if (existingProxy) {\n    return existingProxy;\n  }\n\n  // 防止代理已经代理过的对象\n  // https://github.com/alibaba/hooks/issues/839\n  if (rawMap.has(initialVal)) {\n    return initialVal;\n  }\n\n  const proxy = new Proxy<T>(initialVal, {\n    get(target, key, receiver) {\n      const res = Reflect.get(target, key, receiver);\n\n      // https://github.com/alibaba/hooks/issues/1317\n      const descriptor = Reflect.getOwnPropertyDescriptor(target, key);\n      if (!descriptor?.configurable && !descriptor?.writable) {\n        return res;\n      }\n\n      // Only proxy plain object or array,\n      // otherwise it will cause: https://github.com/alibaba/hooks/issues/2080\n      return isPlainObject(res) || Array.isArray(res) ? observer(res, cb) : res;\n    },\n    set(target, key, val) {\n      const ret = Reflect.set(target, key, val);\n      cb();\n      return ret;\n    },\n    deleteProperty(target, key) {\n      const ret = Reflect.deleteProperty(target, key);\n      cb();\n      return ret;\n    },\n  });\n\n  proxyMap.set(initialVal, proxy);\n  rawMap.set(proxy, initialVal);\n\n  return proxy;\n}\n\nfunction useReactive<S extends Record<string, any>>(initialState: S): S {\n  const update = useUpdate();\n  const stateRef = useRef<S>(initialState);\n\n  const state = useCreation(() => {\n    return observer(stateRef.current, () => {\n      update();\n    });\n  }, []);\n\n  return state;\n}\n\nexport default useReactive;\n",
      "type": "registry:file",
      "target": "src/hooks/ahooks/useReactive/index.ts"
    }
  ],
  "type": "registry:hook"
}
