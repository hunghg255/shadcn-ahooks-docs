{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useRafInterval",
  "title": "useRafInterval",
  "description": "useRafInterval hook",
  "registryDependencies": [
    "useLatest.json",
    "utils.json"
  ],
  "files": [
    {
      "path": "packages/hooks/src/useRafInterval/index.ts",
      "content": "import { useCallback, useEffect, useRef } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils';\n\ninterface Handle {\n  id: ReturnType<typeof setInterval> | ReturnType<typeof requestAnimationFrame>;\n}\n\nconst setRafInterval = (callback: () => void, delay: number = 0): Handle => {\n  if (typeof requestAnimationFrame === 'undefined') {\n    return {\n      id: setInterval(callback, delay),\n    };\n  }\n  let start = Date.now();\n  const handle: Handle = {\n    id: 0,\n  };\n  const loop = () => {\n    const current = Date.now();\n    if (current - start >= delay) {\n      callback();\n      start = Date.now();\n    }\n    handle.id = requestAnimationFrame(loop);\n  };\n  handle.id = requestAnimationFrame(loop);\n  return handle;\n};\n\nconst cancelAnimationFrameIsNotDefined = (t: any): t is ReturnType<typeof setTimeout> => {\n  return typeof cancelAnimationFrame === 'undefined';\n};\n\nconst clearRafInterval = (handle: Handle) => {\n  if (cancelAnimationFrameIsNotDefined(handle.id)) {\n    return clearInterval(handle.id);\n  }\n  cancelAnimationFrame(handle.id);\n};\n\nfunction useRafInterval(\n  fn: () => void,\n  delay: number | undefined,\n  options?: {\n    immediate?: boolean;\n  },\n) {\n  const immediate = options?.immediate;\n\n  const fnRef = useLatest(fn);\n  const timerRef = useRef<Handle>(undefined);\n\n  const clear = useCallback(() => {\n    if (timerRef.current) {\n      clearRafInterval(timerRef.current);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!isNumber(delay) || delay < 0) {\n      return;\n    }\n    if (immediate) {\n      fnRef.current();\n    }\n    timerRef.current = setRafInterval(() => {\n      fnRef.current();\n    }, delay);\n    return clear;\n  }, [delay]);\n\n  return clear;\n}\n\nexport default useRafInterval;\n",
      "type": "registry:file",
      "target": "src/hooks/ahooks/useRafInterval/index.ts"
    }
  ],
  "type": "registry:hook"
}
